<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>벽 충돌 테스트 - 간단 버전</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏠 가구 벽 충돌 감지 테스트</h1>
        
        <div class="status info">
            <strong>테스트 목적:</strong> 가구가 방 경계(벽)를 뚫고 지나가지 않는지 확인
        </div>

        <div class="status info">
            <strong>방 크기:</strong> 15m x 15m (여백 0.5m 포함)<br>
            <strong>사용 가능 공간:</strong> 14m x 14m (중앙 기준 -7m ~ +7m)
        </div>

        <div>
            <button onclick="testWallCollision()">벽 충돌 테스트 실행</button>
            <button onclick="testFurniturePlacement()">가구 배치 테스트</button>
            <button onclick="clearResults()">결과 지우기</button>
        </div>

        <div id="testResults"></div>
    </div>

    <script>
        // 방 경계 설정 (실제 코드와 동일)
        const ROOM_DIMENSIONS = {
            width: 15,
            depth: 15,
            height: 7.5,
            wallThickness: 0.1,
            margin: 0.5
        };

        // 방 경계 계산
        function getRoomBoundaries() {
            const halfWidth = ROOM_DIMENSIONS.width / 2;
            const halfDepth = ROOM_DIMENSIONS.depth / 2;
            
            return {
                minX: -halfWidth + ROOM_DIMENSIONS.margin,
                maxX: halfWidth - ROOM_DIMENSIONS.margin,
                minZ: -halfDepth + ROOM_DIMENSIONS.margin,
                maxZ: halfDepth - ROOM_DIMENSIONS.margin,
                minY: 0,
                maxY: ROOM_DIMENSIONS.height - ROOM_DIMENSIONS.margin
            };
        }

        // 가구 경계 계산
        function getFurnitureBounds(item, safetyMargin = 0.1) {
            const halfWidth = (item.footprint.width * item.scale.x) / 2;
            const halfDepth = (item.footprint.depth * item.scale.z) / 2;
            const height = item.footprint.height * item.scale.y;
            
            return {
                minX: item.position.x - halfWidth - safetyMargin,
                maxX: item.position.x + halfWidth + safetyMargin,
                minZ: item.position.z - halfDepth - safetyMargin,
                maxZ: item.position.z + halfDepth + safetyMargin,
                minY: item.position.y,
                maxY: item.position.y + height + safetyMargin
            };
        }

        // 벽 충돌 감지
        function isFurnitureInRoom(item) {
            const boundaries = getRoomBoundaries();
            const furnitureBounds = getFurnitureBounds(item);
            
            // X축 검증
            if (furnitureBounds.minX < boundaries.minX || furnitureBounds.maxX > boundaries.maxX) {
                return false;
            }
            
            // Z축 검증
            if (furnitureBounds.minZ < boundaries.minZ || furnitureBounds.maxZ > boundaries.maxZ) {
                return false;
            }
            
            // Y축 검증
            if (furnitureBounds.minY < boundaries.minY || furnitureBounds.maxY > boundaries.maxY) {
                return false;
            }
            
            return true;
        }

        // 가구를 방 안으로 제한
        function constrainFurnitureToRoom(item) {
            const boundaries = getRoomBoundaries();
            const furnitureBounds = getFurnitureBounds(item);
            
            const halfWidth = (item.footprint.width * item.scale.x) / 2;
            const halfDepth = (item.footprint.depth * item.scale.z) / 2;
            const height = item.footprint.height * item.scale.y;
            
            let newX = item.position.x;
            let newZ = item.position.z;
            let newY = item.position.y;
            
            // X축 제한
            if (furnitureBounds.minX < boundaries.minX) {
                newX = boundaries.minX + halfWidth;
            } else if (furnitureBounds.maxX > boundaries.maxX) {
                newX = boundaries.maxX - halfWidth;
            }
            
            // Z축 제한
            if (furnitureBounds.minZ < boundaries.minZ) {
                newZ = boundaries.minZ + halfDepth;
            } else if (furnitureBounds.maxZ > boundaries.maxZ) {
                newZ = boundaries.maxZ - halfDepth;
            }
            
            // Y축 제한
            if (furnitureBounds.minY < boundaries.minY) {
                newY = boundaries.minY;
            } else if (furnitureBounds.maxY > boundaries.maxY) {
                newY = boundaries.maxY - height;
            }
            
            return {
                ...item,
                position: { x: newX, y: newY, z: newZ }
            };
        }

        // 테스트 함수들
        function testWallCollision() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<h3>🧪 벽 충돌 테스트 결과</h3>';
            
            const boundaries = getRoomBoundaries();
            results.innerHTML += `<div class="test-result"><strong>방 경계:</strong> X: ${boundaries.minX.toFixed(2)} ~ ${boundaries.maxX.toFixed(2)}, Z: ${boundaries.minZ.toFixed(2)} ~ ${boundaries.maxZ.toFixed(2)}</div>`;
            
            const testPositions = [
                { x: 0, z: 0, name: '방 중앙' },
                { x: 6, z: 0, name: 'X축 벽 근처' },
                { x: 0, z: 6, name: 'Z축 벽 근처' },
                { x: 7.5, z: 0, name: 'X축 벽 밖' },
                { x: 0, z: 7.5, name: 'Z축 벽 밖' },
                { x: 8, z: 8, name: '대각선 벽 밖' }
            ];
            
            testPositions.forEach(pos => {
                const testItem = {
                    name: '소파',
                    footprint: { width: 2.2, depth: 0.9, height: 0.8 },
                    scale: { x: 1, y: 1, z: 1 },
                    position: { x: pos.x, y: 0, z: pos.z }
                };
                
                const isInRoom = isFurnitureInRoom(testItem);
                const constrained = constrainFurnitureToRoom(testItem);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${isInRoom ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <strong>${pos.name} (${pos.x}, ${pos.z}):</strong> 
                    ${isInRoom ? '✅ 방 안' : '❌ 벽 충돌'} 
                    ${!isInRoom ? `→ 제한된 위치: (${constrained.position.x.toFixed(2)}, ${constrained.position.z.toFixed(2)})` : ''}
                `;
                results.appendChild(resultDiv);
            });
        }

        function testFurniturePlacement() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<h3>🪑 가구 배치 테스트 결과</h3>';
            
            const furnitureTypes = [
                { name: '소파', footprint: { width: 2.2, depth: 0.9, height: 0.8 } },
                { name: '침대', footprint: { width: 1.6, depth: 2.0, height: 0.6 } },
                { name: '책장', footprint: { width: 1.2, depth: 0.3, height: 1.8 } },
                { name: '테이블', footprint: { width: 1.0, depth: 1.0, height: 0.7 } }
            ];
            
            furnitureTypes.forEach(furniture => {
                const testItem = {
                    name: furniture.name,
                    footprint: furniture.footprint,
                    scale: { x: 1, y: 1, z: 1 },
                    position: { x: 0, y: 0, z: 0 }
                };
                
                const isInRoom = isFurnitureInRoom(testItem);
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${isInRoom ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <strong>${furniture.name} (${furniture.footprint.width}m x ${furniture.footprint.depth}m x ${furniture.footprint.height}m):</strong> 
                    ${isInRoom ? '✅ 방 중앙 배치 가능' : '❌ 배치 불가능'}
                `;
                results.appendChild(resultDiv);
            });
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        // 초기 테스트 실행
        testWallCollision();
    </script>
</body>
</html>
