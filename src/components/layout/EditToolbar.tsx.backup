'use client';

import React from 'react';
import { useEditorStore, useGridSettings, useSnapStrength, useAutoLock } from '../../store/editorStore';

interface EditToolbarProps {
  onToggleFurnitureCatalog?: () => void;
  showFurnitureCatalog?: boolean;
  onToggleTemplateSelector?: () => void;
  showTemplateSelector?: boolean;
  isMobile?: boolean;
}

export default function EditToolbar({
  onToggleFurnitureCatalog,
  showFurnitureCatalog,
  onToggleTemplateSelector,
  showTemplateSelector,
  isMobile = false
}: EditToolbarProps) {
  const {
    toggleGridSnap,
    setSnapStrength,
    toggleSnapStrength,
    toggleAutoLock,
    setAutoLockDelay,
    undo,
    redo
  } = useEditorStore();

  const gridSettings = useGridSettings();
  const snapStrength = useSnapStrength();
  const autoLock = useAutoLock();

  return (
    <div className={`absolute top-6 left-1/2 transform -translate-x-1/2 bg-white rounded-2xl shadow-2xl border-2 border-gray-200 ${
      isMobile ? 'p-8 max-w-[95vw]' : 'p-6'
    }`} style={{ zIndex: 100 }}>
      <div className={`flex items-center ${isMobile ? 'gap-8 flex-wrap justify-center' : 'gap-6'}`}>
        {/* ê·¸ë¦¬ë“œ ì„¤ì • - ë” ëª…í™•í•œ í† ê¸€ */}
        <div className={`flex items-center ${isMobile ? 'gap-4' : 'gap-3'}`}>
          <button
            onClick={toggleGridSnap}
            className={`px-4 py-2.5 rounded-xl font-medium transition-all duration-300 border-2 ${
              gridSettings.enabled
                ? 'bg-indigo-600 text-white border-indigo-700 shadow-lg'
                : 'bg-gray-100 text-gray-600 border-gray-300 hover:bg-gray-200'
            }`}
            title="ê·¸ë¦¬ë“œ ìŠ¤ëƒ…"
          >
            <div className="flex items-center gap-2">
              <span className="text-lg">ğŸ”²</span>
              <span className="text-sm font-medium">ê·¸ë¦¬ë“œ {gridSettings.enabled ? 'ON' : 'OFF'}</span>
            </div>
          </button>

          {/* ìŠ¤ëƒ… ê°•ë„ ì„¤ì • */}
          <div className={`flex flex-col ${isMobile ? 'gap-2' : 'gap-1'}`}>
            <div className="flex items-center gap-2">
              <button
                onClick={toggleSnapStrength}
                className={`px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-300 border ${
                  snapStrength.enabled
                    ? 'bg-yellow-500 text-white border-yellow-600'
                    : 'bg-gray-100 text-gray-600 border-gray-300'
                }`}
                title="ìŠ¤ëƒ… ê°•ë„ ì¡°ì ˆ"
              >
                <span className="text-xs">ğŸ¯</span>
              </button>
              <span className="text-xs text-gray-600 font-medium">ê°•ë„</span>
            </div>

            {snapStrength.enabled && (
              <div className={`flex ${isMobile ? 'gap-3' : 'gap-2'}`}>
                {/* ê·¸ë¦¬ë“œ ìŠ¤ëƒ… ê°•ë„ */}
                <div className="flex flex-col items-center">
                  <span className="text-xs text-gray-500 mb-1">ì´ë™</span>
                  <input
                    type="range"
                    min="0"
                    max="2"
                    step="0.1"
                    value={snapStrength.translation}
                    onChange={(e) => setSnapStrength({ translation: parseFloat(e.target.value) })}
                    className="w-16 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                    title={`ì´ë™ ìŠ¤ëƒ… ê°•ë„: ${snapStrength.translation.toFixed(1)}`}
                  />
                  <span className="text-xs text-gray-600 mt-1">{snapStrength.translation.toFixed(1)}</span>
                </div>

                {/* íšŒì „ ìŠ¤ëƒ… ê°•ë„ */}
                <div className="flex flex-col items-center">
                  <span className="text-xs text-gray-500 mb-1">íšŒì „</span>
                  <input
                    type="range"
                    min="0"
                    max="2"
                    step="0.1"
                    value={snapStrength.rotation}
                    onChange={(e) => setSnapStrength({ rotation: parseFloat(e.target.value) })}
                    className="w-16 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                    title={`íšŒì „ ìŠ¤ëƒ… ê°•ë„: ${snapStrength.rotation.toFixed(1)}`}
                  />
                  <span className="text-xs text-gray-600 mt-1">{snapStrength.rotation.toFixed(1)}</span>
                </div>
              </div>
            )}

            {/* ìë™ ê³ ì • ì„¤ì • */}
            <div className="flex flex-col items-center gap-2">
              <div className="flex items-center gap-2">
                <button
                  onClick={toggleAutoLock}
                  className={`px-3 py-2 rounded-lg font-medium transition-all duration-300 border-2 ${
                    autoLock.enabled
                      ? 'bg-green-600 text-white border-green-700 shadow-lg'
                      : 'bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200'
                  }`}
                  title={`ìë™ ê³ ì • ${autoLock.enabled ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}`}
                >
                  <div className="flex items-center gap-1">
                    <span className="text-sm">ğŸ”’</span>
                    <span className="text-xs font-medium">ìë™ê³ ì •</span>
                  </div>
                </button>

                {/* ìë™ ê³ ì • ì§€ì—° ì‹œê°„ ì„¤ì • */}
                <div className="flex flex-col items-center">
                  <span className="text-xs text-gray-500 mb-1">ì§€ì—°ì‹œê°„</span>
                  <input
                    type="range"
                    min="500"
                    max="3000"
                    step="100"
                    value={autoLock.delay}
                    onChange={(e) => setAutoLockDelay(parseInt(e.target.value))}
                    className="w-12 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                    title={`ìë™ ê³ ì • ì§€ì—° ì‹œê°„: ${autoLock.delay}ms`}
                  />
                  <span className="text-xs text-gray-600 mt-1">{(autoLock.delay / 1000).toFixed(1)}s</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* êµ¬ë¶„ì„  */}
        <div className="w-0.5 h-12 bg-gradient-to-b from-gray-300 to-gray-400 rounded-full" />

        {/* í¸ì§‘ ë„êµ¬ - ë” ëª…í™•í•œ ë²„íŠ¼ */}
        <div className={`flex ${isMobile ? 'gap-4' : 'gap-3'}`}>
          <button
            onClick={undo}
            className="px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-all duration-300 border-2 border-gray-300 hover:border-gray-400"
            title="ì‹¤í–‰ ì·¨ì†Œ (Ctrl+Z)"
          >
            <div className="flex items-center gap-2">
              <span className="text-lg">â†¶</span>
              <span className="text-sm font-medium">ì‹¤í–‰ì·¨ì†Œ</span>
            </div>
          </button>

          <button
            onClick={redo}
            className="px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-all duration-300 border-2 border-gray-300 hover:border-gray-400"
            title="ë‹¤ì‹œ ì‹¤í–‰ (Ctrl+Y)"
          >
            <div className="flex items-center gap-2">
              <span className="text-lg">â†·</span>
              <span className="text-sm font-medium">ë‹¤ì‹œì‹¤í–‰</span>
            </div>
          </button>
        </div>

        {/* êµ¬ë¶„ì„  */}
        <div className="w-0.5 h-12 bg-gradient-to-b from-gray-300 to-gray-400 rounded-full" />

        {/* ê°€êµ¬ ì¹´íƒˆë¡œê·¸ í† ê¸€ - ë” ëª…í™•í•œ ë²„íŠ¼ */}
        <button
          onClick={onToggleFurnitureCatalog}
          className={`px-5 py-2.5 rounded-xl font-medium transition-all duration-300 border-2 ${
            showFurnitureCatalog
              ? 'bg-blue-600 text-white border-blue-700 shadow-lg'
              : 'bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 hover:border-gray-400'
          }`}
          title="ê°€êµ¬ ì¹´íƒˆë¡œê·¸"
        >
          <div className="flex items-center gap-2">
            <span className="text-lg">ğŸª‘</span>
            <span className="text-sm font-medium">ê°€êµ¬</span>
          </div>
        </button>

        {/* ë£¸ í…œí”Œë¦¿ í† ê¸€ */}
        <button
          onClick={onToggleTemplateSelector}
          className={`px-5 py-2.5 rounded-xl font-medium transition-all duration-300 border-2 ${
            showTemplateSelector
              ? 'bg-purple-600 text-white border-purple-700 shadow-lg'
              : 'bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 hover:border-gray-400'
          }`}
          title="ë£¸ í…œí”Œë¦¿"
        >
          <div className="flex items-center gap-2">
            <span className="text-lg">ğŸ </span>
            <span className="text-sm font-medium">í…œí”Œë¦¿</span>
          </div>
        </button>
      </div>
    </div>
  );
}
